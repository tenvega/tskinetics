---
/**
 * Cart Icon Component
 * Displays shopping cart icon with item count badge in header
 * Triggers cart drawer when clicked
 */
---

<button
    id="cart-icon-button"
    class="relative p-2 text-gray-300 hover:text-white transition-colors"
    aria-label="Shopping cart"
    data-analytics-event="cart_icon_clicked"
>
    <!-- Shopping Cart SVG Icon -->
    <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
    >
        <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
    </svg>

    <!-- Item Count Badge -->
    <span
        id="cart-count-badge"
        class="absolute -top-1 -right-1 bg-white text-black text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center opacity-0 scale-0 transition-all duration-300"
        data-count="0"
    >
        0
    </span>
</button>

<script>
    import { getCart } from "../../lib/cart";

    function updateCartIcon() {
        const badge = document.getElementById("cart-count-badge");
        if (!badge) return;

        const cart = getCart();
        const count = cart.totalItems;

        badge.textContent = count.toString();
        badge.setAttribute("data-count", count.toString());

        if (count > 0) {
            badge.classList.remove("opacity-0", "scale-0");
            badge.classList.add("opacity-100", "scale-100");
        } else {
            badge.classList.remove("opacity-100", "scale-100");
            badge.classList.add("opacity-0", "scale-0");
        }
    }

    // Initialize on page load
    document.addEventListener("DOMContentLoaded", () => {
        updateCartIcon();

        // Update when cart changes
        window.addEventListener("cart-updated", () => {
            updateCartIcon();

            // Add pulse animation when item added
            const badge = document.getElementById("cart-count-badge");
            if (badge) {
                badge.classList.add("animate-pulse");
                setTimeout(() => {
                    badge.classList.remove("animate-pulse");
                }, 1000);
            }
        });

        // Open cart drawer when clicked
        const cartButton = document.getElementById("cart-icon-button");
        if (cartButton) {
            cartButton.addEventListener("click", () => {
                // Dispatch event to open cart drawer
                window.dispatchEvent(new CustomEvent("open-cart-drawer"));
            });
        }
    });

    // Update on page navigation (for SPAs or view transitions)
    document.addEventListener("astro:page-load", () => {
        updateCartIcon();
    });
</script>

<style>
    /* Pulse animation for badge */
    @keyframes pulse {
        0%,
        100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }

    .animate-pulse {
        animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) 2;
    }
</style>
